#!/bin/bash
#
# ------------------------
# Post installation script
# ------------------------

ask() {
    # Function to ask questions
    #
    # source: https://gist.github.com/davejamesmiller/1965569
    local prompt default reply

    if [[ ${2:-} = 'Y' ]]; then
        prompt='Y/n'
        default='Y'
    elif [[ ${2:-} = 'N' ]]; then
        prompt='y/N'
        default='N'
    else
        prompt='y/n'
        default=''
    fi

    while true; do
        # Ask the question (not using "read -p" as it uses stderr not stdout)
        echo -n "$1 [$prompt] "
        # Read the answer (use /dev/tty in case stdin is redirected from somewhere else)
        read -r reply </dev/tty
        # Default?
        if [[ -z $reply ]]; then
            reply=$default
        fi
        # Check if the reply is valid
        case "$reply" in
            Y*|y*) return 0 ;;
            N*|n*) return 1 ;;
        esac
    done
}



clear
echo "

 ▄▄▄·      .▄▄ · ▄▄▄▄▄    ▪   ▐ ▄ .▄▄ · ▄▄▄▄▄ ▄▄▄· ▄▄▌  ▄▄▌      .▄▄ ·  ▄▄· ▄▄▄  ▪   ▄▄▄·▄▄▄▄▄
▐█ ▄█▪     ▐█ ▀. •██      ██ •█▌▐█▐█ ▀. •██  ▐█ ▀█ ██•  ██•      ▐█ ▀. ▐█ ▌▪▀▄ █·██ ▐█ ▄█•██
 ██▀· ▄█▀▄ ▄▀▀▀█▄ ▐█.▪    ▐█·▐█▐▐▌▄▀▀▀█▄ ▐█.▪▄█▀▀█ ██▪  ██▪      ▄▀▀▀█▄██ ▄▄▐▀▀▄ ▐█· ██▀· ▐█.▪
▐█▪·•▐█▌.▐▌▐█▄▪▐█ ▐█▌·    ▐█▌██▐█▌▐█▄▪▐█ ▐█▌·▐█ ▪▐▌▐█▌▐▌▐█▌▐▌    ▐█▄▪▐█▐███▌▐█•█▌▐█▌▐█▪·• ▐█▌·
.▀    ▀█▄▀▪ ▀▀▀▀  ▀▀▀     ▀▀▀▀▀ █▪ ▀▀▀▀  ▀▀▀  ▀  ▀ .▀▀▀ .▀▀▀      ▀▀▀▀ ·▀▀▀ .▀  ▀▀▀▀.▀    ▀▀▀

"


# Copy dotfiles
echo
if ask ":: Copy the dotfiles to your home folder?" Y; then
    echo "Copying dotfiles [...]"
    # Copy every dotfile in your home directory
    # (except dirs that start with an underscore)
    for directory in [^_]*/; do
        cp -r ${directory%/}/. ~;
    done
else
    echo "Skipping..."
fi

echo
if ask ":: Create symlinks for scripts in ~/bin?" Y; then
    echo "Creating symlinks for any ~/bin/ to ~/local/bin [...]"
    # Create symlinks to ~/bin/ files inside ~/.local/bin
    for binfile in ~/bin/*; do
        ln -s -i $binfile ~/.local/bin;
    done
else
    echo "Skipping..."
fi

echo
if ask ":: Change shell to zsh?" Y; then
    chsh -s /usr/bin/zsh
else
    echo "Skipping..."
fi

echo
if ask ":: Install Neovim plugins?" Y; then
    nvim -c "PlugInstall"
else
    echo "Skipping..."
fi

echo
if ask ":: Download and install mambaforge?" Y; then
    echo "Downloading mambaforge [...]"
    echo "  ** Remember to install in ~/.mambaforge **"
    curl -L -O https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-$(uname)-$(uname -m).sh
    bash Mambaforge-$(uname)-$(uname -m).sh
else
    echo "Skipping..."
fi

echo
if ask ":: Customize XFCE appearance and keyboard shortcuts?" Y; then
    ./customize_xfce
else
    echo "Skipping..."
fi
